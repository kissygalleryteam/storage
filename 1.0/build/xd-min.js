/*!build time : 2013-10-30 1:05:21 AM*/
KISSY.add("gallery/storage/1.0/xd",function(a,b,c){function d(){r?b.on(q,"message",e):u.onMessage(e)}function e(b){var d={};try{d=c.parse(b.data)}catch(e){return}if(h in d&&i in d){var f=d[i];if(f){var g=s[f];if(clearTimeout(g),s[f]=0,!g)return}a.each(t,function(a){a.get(j)(d)})}}function f(a){var b=this;if(++v>1)throw"XD is singleton";b._opt=a,b.init()}var g=0,h="__ga_xd_from",i="__ga_xd_to",j="receive",k="target",l="timeout",m="iframeTimeout",n=10,o=10,p=3e3,q=window,r=q.postMessage,s={},t=[],u={uid:0,hid:-1,q:[],tm:0,postMessage:function(a,b){var c=++u.uid,d=u.q,e={name:+new Date+""+c+"^"+document.domain+"&"+b,uid:c,target:a};d.push(e),u.tm||(u.tm=setInterval(function(){var a=u.q;if(!(0===a.length||a[0].uid<=u.hid)){var b=a[0];u.hid=b.uid,b.target.name=b.name}},o))},onMessage:function(a){function b(){var b=q.name;if(b!==c){u.q.shift(),c=b;var e=d.exec(b);if(!e)return;var f={origin:e[2],data:e[3]};a&&a(f)}}var c="",d=/^(\d+?)\^(.+?)&(.*?)$/;setInterval(b,n)}};d();var v=0;return a.augment(f,{init:function(){var a=this;t.push(a)},send:function(b,d){function f(){var a={};a.origin="*";var d={};d.c=b.c||"",d[h]=0,d[i]=0,a.data=c.stringify(d),e(a)}if(a.isObject(b)){var j=this,n=j.get(k),o=j.get(l)||p,q=++g;d=d||"*",b[i]=b[h]||0,b[h]=q;var t=c.stringify(b);s[q]=setTimeout(function(){s[q]=0,f()},o),j.get(m)?f():r?n.postMessage(t,d):u.postMessage(n,t,d)}},get:function(a){return this._opt[a]},set:function(a,b){this._opt[a]=b}}),f},{requires:["event","json"]});